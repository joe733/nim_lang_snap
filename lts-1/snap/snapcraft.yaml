name: nim-lang-lts-1
summary: Nim programming language, compiler, and other tools.
description: |
  Nim is a compiled, garbage-collected systems programming language with 
  a design that focuses on efficiency, expressiveness, and elegance.
version: VERSION
base: core18
grade: stable
confinement: strict
architectures:
  - build-on: amd64
    run-on: amd64

apps:
  nim:
    command: bin/nim
    plugs: [home]
  nimble:
    command: bin/nimble
    plugs: [home, network]
  nimcsources:
    command: bin/nim_csources
    plugs: [home]
  nimfind:
    command: bin/nimfind
    plugs: [home]
  nimgdb:
    command: bin/nim-gdb
    plugs: [home]
  nimgrep:
    command: bin/nimgrep
    plugs: [home]
  nimpretty:
    command: bin/nimpretty
    plugs: [home]
  nimsuggest:
    command: bin/nimsuggest
    plugs: [home]
  testament:
    command: bin/testament
    plugs: [home]
  gcc:
    command: usr/bin/gcc
    plugs: [home]
  clang:
    command: usr/bin/clang
    plugs: [home]

parts:
  nim-build:
    source: RELEASEURL
    source-type: tar
    plugin: autotools
    override-build: |
      sh build_all.sh --os linux --cpu amd64
      bin/nim c koch
      ./koch tools
      ./koch docs
      rm bin/empty.txt
      chmod u+x bin/*
      mkdir "$SNAPCRAFT_PART_INSTALL"/bin
      mkdir "$SNAPCRAFT_PART_INSTALL"/lib
      mkdir "$SNAPCRAFT_PART_INSTALL"/doc
      mkdir -p "$SNAPCRAFT_PART_INSTALL"/usr/bin
      mkdir "$SNAPCRAFT_PART_INSTALL"/usr/lib
      mv bin/* "$SNAPCRAFT_PART_INSTALL"/bin
      mv lib/* "$SNAPCRAFT_PART_INSTALL"/lib
      mv doc/* "$SNAPCRAFT_PART_INSTALL"/doc
      mv tools/nim.bash-completion "$SNAPCRAFT_PART_INSTALL"
      mv dist/nimble/nimble.bash-completion "$SNAPCRAFT_PART_INSTALL"
      cp /usr/bin/gcc "$SNAPCRAFT_PART_INSTALL"/usr/bin
      cp /usr/bin/clang "$SNAPCRAFT_PART_INSTALL"/usr/bin
      cp -a /usr/lib/clang "$SNAPCRAFT_PART_INSTALL"/usr/lib
      cp -a /usr/lib/llvm-6.0 "$SNAPCRAFT_PART_INSTALL"/usr/lib
      cp -a /usr/lib/gcc "$SNAPCRAFT_PART_INSTALL"/usr/lib
    build-packages:
      - gcc
      - git
      - clang
      - llvm-6.0-dev
      - libc6-dev